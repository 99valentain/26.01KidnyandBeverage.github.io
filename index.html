<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 연구노트: 음료와 신장 건강 (Mobile Ver.)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <!-- 폰트 (Pretendard) -->
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />

    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #F8FAFC;
            color: #1E293B;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden; /* 가로 스크롤 방지 */
        }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* 채팅 스타일 */
        .chat-content { font-size: 0.95rem; line-height: 1.6; }
        .chat-content strong { color: #4F46E5; font-weight: 700; }
        .chat-content ul { list-style-type: disc; padding-left: 1.2rem; margin: 0.5rem 0; }
        
        /* 버튼 바운스 효과 */
        .bounce-btn:active { transform: scale(0.95); }
        
        /* 모바일 카드 스타일 강화 */
        .mobile-card {
            border-radius: 1.5rem;
            box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="antialiased selection:bg-indigo-100 selection:text-indigo-900 pb-20">

    <!-- 네비게이션 (심플하게 변경) -->
    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-slate-200">
        <div class="max-w-6xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <span class="text-2xl animate-bounce">🫘</span>
                    <div>
                        <h1 class="font-bold text-slate-800 text-lg leading-none">2026 연구노트</h1>
                        <p class="text-[11px] text-slate-500 mt-1">Mobile Interactive Dashboard</p>
                    </div>
                </div>
                <!-- 탭 메뉴 (가로 스크롤) -->
                <div class="flex gap-2 text-sm font-bold text-slate-500">
                    <a href="#lab" class="px-3 py-1.5 rounded-full bg-slate-100 text-indigo-600">실험실</a>
                    <a href="#chat" class="px-3 py-1.5 rounded-full bg-slate-100 text-slate-600">챗봇</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-3xl mx-auto px-4 py-6 space-y-12">

        <!-- 섹션 1: 연구 개요 (Hero) -->
        <section id="overview" class="mobile-card bg-gradient-to-br from-stone-800 to-stone-700 p-6 text-white overflow-hidden relative">
            <!-- 배경 효과 -->
            <div class="absolute -top-10 -right-10 w-40 h-40 bg-yellow-500/20 rounded-full blur-3xl"></div>
            <div class="absolute -bottom-10 -left-10 w-40 h-40 bg-stone-500/30 rounded-full blur-3xl"></div>

            <div class="relative z-10 flex flex-col gap-6">
                <div>
                    <div class="inline-block px-3 py-1 bg-yellow-500/90 text-yellow-900 rounded-full text-[10px] font-bold mb-3 shadow-lg">
                        2026년 1월 연구과제
                    </div>
                    <h2 class="text-3xl font-extrabold mb-3 leading-tight">
                        한국인의 커피,<br>
                        <span class="text-stone-300">신장</span>에 약일까?
                    </h2>
                    <p class="text-stone-300 text-sm leading-relaxed font-light">
                        블랙커피 vs 믹스커피.<br>
                        무엇을 마시는지에 따라 당신의 콩팥 건강이 달라질 수 있습니다. KNHANES 빅데이터 분석 결과를 확인하세요.
                    </p>
                </div>

                <!-- Research Key Metrics (모바일 최적화) -->
                <div class="bg-white/10 backdrop-blur-md p-5 rounded-xl border border-white/10 shadow-inner">
                    <h3 class="text-[10px] font-bold text-stone-300 uppercase tracking-widest mb-4 border-b border-white/10 pb-2">Research Key Metrics</h3>
                    <div class="space-y-5">
                        <div>
                            <div class="flex justify-between text-xs mb-1.5">
                                <span class="text-stone-300">분석 데이터</span>
                                <span class="font-bold text-yellow-400">KNHANES</span>
                            </div>
                            <div class="w-full bg-stone-700/50 h-1.5 rounded-full overflow-hidden">
                                <div class="bg-yellow-400 h-full" style="width: 100%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs mb-1.5">
                                <span class="text-stone-300">타겟 변수</span>
                                <span class="font-bold text-emerald-400">eGFR (사구체여과율)</span>
                            </div>
                            <div class="w-full bg-stone-700/50 h-1.5 rounded-full overflow-hidden">
                                <div class="bg-emerald-400 h-full" style="width: 85%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-xs mb-1.5">
                                <span class="text-stone-300">핵심 비교군</span>
                                <span class="font-bold text-rose-300">Black vs. Mix</span>
                            </div>
                            <div class="flex gap-1 h-1.5">
                                <div class="bg-stone-900 w-1/2 rounded-l-full"></div>
                                <div class="bg-orange-300 w-1/2 rounded-r-full"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 섹션 2: 신장 지키기 게임 (모바일 터치 최적화) -->
        <section id="lab" class="mobile-card bg-white p-6 border border-slate-100 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-emerald-400 via-amber-400 to-rose-500"></div>
            
            <div class="text-center mb-6 mt-2">
                <h2 class="text-2xl font-bold text-slate-900">🧪 내 신장 다마고치</h2>
                <p class="text-slate-500 text-xs mt-1">버튼을 터치해 음료를 마셔보세요!</p>
            </div>

            <!-- 아바타 & 상태창 -->
            <div class="bg-slate-50 rounded-2xl p-6 flex flex-col items-center justify-center mb-6 border border-slate-200">
                <div class="absolute top-4 right-4">
                    <button onclick="resetDrinks()" class="text-xs bg-white px-3 py-1.5 rounded-full border border-slate-200 shadow-sm text-slate-500 active:bg-slate-100">↺ 리셋</button>
                </div>
                
                <div id="kidney-char" class="text-[80px] mb-3 transition-all duration-300 animate__animated animate__pulse animate__infinite cursor-pointer" onclick="pokeKidney()">
                    🫘
                </div>
                
                <h3 id="status-title" class="text-xl font-black text-slate-800 mb-1">매우 건강함</h3>
                <p id="status-desc" class="text-xs text-slate-500 bg-white px-3 py-1.5 rounded-lg shadow-sm border border-slate-100">
                    "항산화 성분으로 보호받고 있어요!"
                </p>

                <!-- 게이지 -->
                <div class="w-full mt-5 bg-slate-200 rounded-full h-2.5 overflow-hidden">
                    <div id="health-bar" class="bg-emerald-500 h-full w-full transition-all duration-700 ease-out"></div>
                </div>
            </div>

            <!-- 컨트롤 패널 (2열 그리드) -->
            <div class="grid grid-cols-2 gap-3 mb-4">
                <!-- 차 -->
                <button onclick="addDrink('tea')" class="bounce-btn bg-emerald-50 border border-emerald-100 rounded-xl p-3 flex flex-col items-center relative active:bg-emerald-100">
                    <span class="text-3xl mb-1">🍵</span>
                    <span class="font-bold text-sm text-slate-700">녹차/홍차</span>
                    <span class="text-[10px] text-emerald-600 font-medium">+ 항산화 (Good)</span>
                    <span id="count-tea" class="absolute top-2 right-2 bg-white text-emerald-700 text-[10px] font-bold px-1.5 py-0.5 rounded-full shadow-sm border border-emerald-100">0</span>
                </button>
                
                <!-- 블랙커피 -->
                <button onclick="addDrink('black')" class="bounce-btn bg-slate-50 border border-slate-200 rounded-xl p-3 flex flex-col items-center relative active:bg-slate-100">
                    <span class="text-3xl mb-1">☕</span>
                    <span class="font-bold text-sm text-slate-700">블랙커피</span>
                    <span class="text-[10px] text-slate-500 font-medium">적당히 (Okay)</span>
                    <span id="count-black" class="absolute top-2 right-2 bg-white text-slate-700 text-[10px] font-bold px-1.5 py-0.5 rounded-full shadow-sm border border-slate-200">0</span>
                </button>

                <!-- 믹스커피 -->
                <button onclick="addDrink('mix')" class="bounce-btn bg-amber-50 border border-amber-100 rounded-xl p-3 flex flex-col items-center relative active:bg-amber-100">
                    <span class="text-3xl mb-1">🍬</span>
                    <span class="font-bold text-sm text-slate-700">믹스커피</span>
                    <span class="text-[10px] text-amber-600 font-medium">- 당분/프림 (Bad)</span>
                    <span id="count-mix" class="absolute top-2 right-2 bg-white text-amber-700 text-[10px] font-bold px-1.5 py-0.5 rounded-full shadow-sm border border-amber-100">0</span>
                </button>

                <!-- 가당음료 -->
                <button onclick="addDrink('ssb')" class="bounce-btn bg-rose-50 border border-rose-100 rounded-xl p-3 flex flex-col items-center relative active:bg-rose-100">
                    <span class="text-3xl mb-1">🥤</span>
                    <span class="font-bold text-sm text-slate-700">탄산/주스</span>
                    <span class="text-[10px] text-rose-600 font-medium">-- 위험 (Worst)</span>
                    <span id="count-ssb" class="absolute top-2 right-2 bg-white text-rose-700 text-[10px] font-bold px-1.5 py-0.5 rounded-full shadow-sm border border-rose-100">0</span>
                </button>
            </div>

            <!-- 당뇨 옵션 -->
            <label class="flex items-center justify-center gap-2 p-3 bg-slate-50 rounded-xl cursor-pointer active:bg-slate-100 border border-slate-200">
                <input type="checkbox" id="check-diabetes" class="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500" onchange="updateKidneyStatus()">
                <span class="text-sm font-bold text-slate-600">🩸 당뇨병 있음 (위험도 증가)</span>
            </label>
        </section>

        <!-- 섹션 3: 챗봇 (API 없음, 룰 기반) -->
        <section id="chat" class="mobile-card bg-white border border-slate-100 shadow-xl flex flex-col h-[500px] overflow-hidden">
            <div class="p-4 bg-indigo-50/50 border-b border-indigo-50 flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 bg-indigo-500 rounded-full animate-pulse"></span>
                    <span class="font-bold text-slate-700">AI 하늘씨.</span>
                </div>
                <span class="text-[10px] text-indigo-400 font-medium">Auto-Reply Mode</span>
            </div>

            <div id="chat-window" class="flex-1 p-4 overflow-y-auto space-y-4 bg-white">
                <div class="flex gap-3">
                    <div class="flex-shrink-0 w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center text-lg">👩‍🔬</div>
                    <div class="bg-slate-50 p-3 rounded-2xl rounded-tl-none border border-slate-100 shadow-sm text-sm text-slate-700 max-w-[90%] chat-content">
                        안녕하세요! 저는 음료와 신장 건강을 연구하는 <strong>AI 하늘씨.</strong>입니다.<br><br>
                        <strong>'믹스커피', '블랙커피', '녹차', '가당음료'</strong> 중 궁금한 단어를 입력해보세요. 제가 아주 상세하게 설명해 드릴게요! 🧐
                    </div>
                </div>
            </div>

            <!-- 추천 질문 (가로 스크롤) -->
            <div class="px-4 py-2 flex gap-2 overflow-x-auto hide-scrollbar bg-white border-t border-slate-50">
                <button onclick="askBot('믹스커피가 위험해?')" class="whitespace-nowrap px-3 py-1.5 bg-slate-50 border border-slate-100 text-slate-600 text-xs rounded-full active:bg-slate-100">믹스커피 위험성?</button>
                <button onclick="askBot('녹차 효능은?')" class="whitespace-nowrap px-3 py-1.5 bg-slate-50 border border-slate-100 text-slate-600 text-xs rounded-full active:bg-slate-100">녹차 효능?</button>
                <button onclick="askBot('eGFR이 뭐야?')" class="whitespace-nowrap px-3 py-1.5 bg-slate-50 border border-slate-100 text-slate-600 text-xs rounded-full active:bg-slate-100">eGFR이란?</button>
            </div>

            <div class="p-4 bg-white border-t border-slate-100">
                <div class="flex gap-2 relative">
                    <input type="text" id="chat-input" placeholder="키워드 입력 (예: 당뇨)" class="w-full bg-slate-50 border-0 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-500 transition-all">
                    <button onclick="handleChat()" class="absolute right-2 top-2 bg-indigo-600 text-white p-1.5 rounded-lg active:bg-indigo-700 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7" /></svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- 섹션 4: 통합 차트 (세로 배치) -->
        <section id="analysis" class="space-y-6">
            <div class="mobile-card bg-white p-6 border border-slate-100">
                <h4 class="font-bold text-lg text-slate-800 mb-4 text-center flex items-center justify-center gap-2">
                    <span class="w-1.5 h-1.5 bg-slate-800 rounded-full"></span> 1잔당 영양 성분
                </h4>
                <div class="chart-container h-[250px]">
                    <canvas id="nutrientChart"></canvas>
                </div>
            </div>
            <div class="mobile-card bg-white p-6 border border-slate-100">
                <h4 class="font-bold text-lg text-slate-800 mb-4 text-center flex items-center justify-center gap-2">
                    <span class="w-1.5 h-1.5 bg-slate-800 rounded-full"></span> 신장 위험 가설
                </h4>
                <div class="chart-container h-[250px]">
                    <canvas id="hypothesisChart"></canvas>
                </div>
            </div>
        </section>

        <!-- 랜덤 상식 -->
        <section class="mobile-card bg-indigo-600 p-6 text-white text-center">
            <h3 class="text-xl font-bold mb-4">🎲 랜덤 영양 상식</h3>
            <div id="fact-card" class="bg-white/10 p-4 rounded-xl min-h-[80px] flex items-center justify-center mb-4 border border-white/20">
                <p id="fact-text" class="text-sm">"가당음료를 매일 마시면 신장 결석 위험이 23% 증가합니다."</p>
            </div>
            <button onclick="showRandomFact()" class="w-full bg-white text-indigo-600 py-3 rounded-xl font-bold text-sm active:bg-indigo-50">
                새로운 지식 확인하기
            </button>
        </section>

        <!-- 푸터 -->
        <section class="text-center pt-8 pb-10">
            <p class="text-slate-400 text-xs font-medium">© 2026 하늘씨.</p>
        </section>

    </main>

    <!-- 스크립트 (API 관련 코드 없음) -->
    <script>
        // --- 1. 신장 게임 로직 ---
        const counts = { black: 0, tea: 0, mix: 0, ssb: 0 };
        const kidneyStates = {
            great: { icon: "🫘", title: "최상의 컨디션!", desc: "항산화 성분으로 보호받고 있어요.", color: "bg-emerald-500" },
            good: { icon: "🙂", title: "양호함", desc: "수분을 충분히 섭취하고 계시네요.", color: "bg-blue-500" },
            warn: { icon: "😵‍💫", title: "부담 느끼는 중...", desc: "당분이 너무 많아요! 신장이 힘들어합니다.", color: "bg-amber-500" },
            bad: { icon: "🤮", title: "SOS! 위험해요", desc: "당장 그만 마셔야 해요! 신장 과부하 상태!", color: "bg-rose-600" }
        };

        function addDrink(type) {
            counts[type]++;
            document.getElementById(`count-${type}`).innerText = counts[type];
            updateKidneyStatus();
        }

        function resetDrinks() {
            for (let k in counts) counts[k] = 0;
            document.querySelectorAll('[id^="count-"]').forEach(el => el.innerText = '0');
            updateKidneyStatus();
        }

        function pokeKidney() {
            const char = document.getElementById('kidney-char');
            char.classList.add('animate__rubberBand');
            setTimeout(() => char.classList.remove('animate__rubberBand'), 1000);
        }

        function updateKidneyStatus() {
            let score = 100;
            score += (counts.black * 2) + (counts.tea * 3);
            score -= (counts.mix * 5) + (counts.ssb * 10);
            
            const hasDiabetes = document.getElementById('check-diabetes').checked;
            if (hasDiabetes) score -= (counts.mix * 2) + (counts.ssb * 5);

            score = Math.max(0, Math.min(100, score));

            let state = 'great';
            if (score < 30) state = 'bad';
            else if (score < 60) state = 'warn';
            else if (score < 85) state = 'good';

            const charEl = document.getElementById('kidney-char');
            const barEl = document.getElementById('health-bar');
            
            charEl.innerText = kidneyStates[state].icon;
            document.getElementById('status-title').innerText = kidneyStates[state].title;
            document.getElementById('status-desc').innerText = kidneyStates[state].desc;
            
            barEl.style.width = `${score}%`;
            barEl.className = `h-full w-full transition-all duration-500 ease-out ${kidneyStates[state].color}`;
            
            charEl.classList.remove('animate__pulse');
            void charEl.offsetWidth; 
            charEl.classList.add('animate__swing');
            setTimeout(() => {
                charEl.classList.remove('animate__swing');
                charEl.classList.add('animate__pulse');
            }, 1000);
        }

        // --- 2. 챗봇 (상세 답변 로직) ---
        const botResponses = {
            "믹스": "믹스커피는 한국인의 소울 푸드지만, 신장에는 부담이 될 수 있어요. 😥<br><br>주성분인 **설탕과 프림(포화지방)**은 혈당과 콜레스테롤을 높여 **대사증후군**을 유발할 수 있거든요. 대사증후군은 신장 기능을 떨어뜨리는 주요 원인이 됩니다.<br><br>👉 가급적 하루 1잔 이하로 줄이시거나, 설탕을 뺀 블랙커피로 바꾸시는 걸 추천드려요!",
            "블랙": "블랙커피는 적당히 드시면 신장에 친구가 될 수 있어요! ☕<br><br>커피 속 **폴리페놀(항산화 성분)**이 염증을 줄여주기 때문이죠. 여러 연구에서 하루 3잔 정도의 블랙커피는 신장 질환 위험을 낮춘다는 결과가 있습니다.<br><br>👉 단, 카페인에 민감하시거나 불면증이 있다면 조절이 필요해요.",
            "녹차": "녹차나 홍차는 아주 훌륭한 선택이에요! 🍵<br><br>**카테킨** 같은 강력한 항산화 성분이 혈관을 건강하게 하고, 신장 세포를 보호하는 데 도움을 줍니다. 또한 수분 섭취를 돕기 때문에 신장 결석 예방에도 긍정적이죠.<br><br>👉 설탕 없이 맑게 우려 드시는 게 가장 좋습니다.",
            "가당": "가당음료(탄산, 주스)는 신장에 **가장 위험한 적**입니다! 🚨<br><br>액상과당은 체내에서 요산 수치를 높여 신장 결석을 유발하고, 급격한 혈당 상승으로 신장 여과기(사구체)를 망가뜨립니다.<br><br>👉 갈증 날 땐 음료수 대신 물이나 탄산수를 드시는 게 어떨까요?",
            "당뇨": "당뇨병 환자분들은 혈당 관리가 곧 신장 관리입니다. 🩸<br><br>믹스커피나 가당음료처럼 혈당을 빠르게 올리는 음료는 **치명적**일 수 있어요. 신장 합병증을 막기 위해 당분 섭취를 엄격히 제한하고, 물이나 녹차 위주로 수분을 섭취해 주세요!",
            "egfr": "**eGFR(사구체여과율)**은 신장이 1분에 얼마나 많은 피를 깨끗하게 걸러내는지를 보여주는 '신장 성적표'예요. 💯<br><br>• <strong>90 이상:</strong> 아주 건강함<br>• <strong>60~89:</strong> 약간의 기능 감소 (주의)<br>• <strong>60 미만:</strong> 신장 기능 저하 의심 (전문의 상담 필요)<br><br>이 수치를 잘 지키는 것이 중요합니다!",
            "연구": "본 연구는 2026년 1월부터 경희대학교에서 진행 중입니다. 👩‍🔬<br><br>서구권 연구와 달리, 한국인의 특성인 **'믹스커피'** 섭취가 신장에 미치는 영향을 중점적으로 분석하고 있어요. 우리의 식습관에 맞는 건강 가이드를 만드는 것이 목표랍니다!",
            "default": "죄송해요, 제가 아직 배우고 있는 중이라 어려운 말은 잘 모르겠어요. 😅<br><br>대신 <strong>'믹스커피', '블랙커피', '녹차', '가당음료', 'eGFR'</strong> 같은 단어로 물어봐 주시면 제가 아는 한에서 아주 자세히 설명해 드릴게요!"
        };

        function askBot(msg) {
            document.getElementById('chat-input').value = msg;
            handleChat();
        }

        async function handleChat() {
            const input = document.getElementById('chat-input');
            const history = document.getElementById('chat-window');
            const msg = input.value.trim();
            if (!msg) return;

            // 유저 메시지
            history.innerHTML += `<div class="flex gap-3 justify-end animate__animated animate__fadeInUp"><div class="bg-indigo-600 text-white p-3 rounded-2xl rounded-tr-none text-sm max-w-[85%] shadow-md">${msg}</div></div>`;
            input.value = '';
            history.scrollTop = history.scrollHeight;

            // 로딩 UI
            const loadingId = 'loading-' + Date.now();
            history.innerHTML += `<div id="${loadingId}" class="flex gap-3 animate__animated animate__fadeInUp"><div class="flex-shrink-0 w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center text-lg">👩‍🔬</div><div class="bg-slate-50 p-3 rounded-2xl rounded-tl-none border border-slate-100 shadow-sm text-sm text-slate-700 max-w-[90%] chat-content"><div class="typing-indicator"><span></span><span></span><span></span></div></div></div>`;
            history.scrollTop = history.scrollHeight;

            // 답변 지연 (자연스러움)
            await new Promise(r => setTimeout(r, 600));

            let reply = "";
            if (msg.includes("믹스")) reply = botResponses["믹스"];
            else if (msg.includes("블랙") || msg.includes("아메리카노")) reply = botResponses["블랙"];
            else if (msg.includes("녹차") || msg.includes("홍차") || msg.includes("차")) reply = botResponses["녹차"];
            else if (msg.includes("가당") || msg.includes("탄산") || msg.includes("주스") || msg.includes("콜라")) reply = botResponses["가당"];
            else if (msg.includes("당뇨")) reply = botResponses["당뇨"];
            else if (msg.toLowerCase().includes("egfr") || msg.includes("수치") || msg.includes("점수")) reply = botResponses["egfr"];
            else if (msg.includes("연구") || msg.includes("결과")) reply = botResponses["연구"];
            else reply = botResponses["default"];

            // 마크다운 처리
            reply = marked.parse(reply);

            document.getElementById(loadingId).remove();
            history.innerHTML += `<div class="flex gap-3 animate__animated animate__fadeInUp"><div class="flex-shrink-0 w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center text-lg">👩‍🔬</div><div class="bg-slate-50 p-3 rounded-2xl rounded-tl-none border border-slate-100 shadow-sm text-sm text-slate-700 max-w-[90%] chat-content">${reply}</div></div>`;
            history.scrollTop = history.scrollHeight;
        }

        document.getElementById('chat-input').addEventListener('keypress', (e) => { if (e.key === 'Enter') handleChat(); });

        // --- 3. 차트 & 랜덤 상식 ---
        function initCharts() {
            new Chart(document.getElementById('nutrientChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['블랙', '차', '믹스', '가당'],
                    datasets: [
                        { label: '카페인', data: [70, 30, 50, 0], backgroundColor: '#475569', borderRadius: 4 },
                        { label: '당류', data: [0, 0, 6, 25], backgroundColor: '#fbbf24', borderRadius: 4 },
                        { label: '지방', data: [0, 0, 1.5, 0], backgroundColor: '#f43f5e', borderRadius: 4 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true } } }
            });

            new Chart(document.getElementById('hypothesisChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['0잔', '1잔', '2잔', '3잔', '4+'],
                    datasets: [
                        { label: '차 (Tea)', data: [100, 102, 104, 105, 103], borderColor: '#10b981', tension: 0.4 },
                        { label: '블랙커피', data: [100, 102, 103, 101, 98], borderColor: '#475569', tension: 0.4 },
                        { label: '믹스커피', data: [100, 98, 95, 90, 85], borderColor: '#f59e0b', borderDash: [5, 5], tension: 0.4 },
                        { label: '가당음료', data: [100, 95, 88, 75, 60], borderColor: '#f43f5e', borderDash: [2, 2], tension: 0.4 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 50, max: 110 } } }
            });
        }

        const facts = [
            "⚠️ 믹스커피 1잔 = 각설탕 2개!",
            "🍵 녹차는 CKD 위험을 낮출 수 있어요.",
            "🩸 고혈당은 신장의 적입니다.",
            "🥤 탄산음료는 신장 결석 위험을 높여요."
        ];

        function showRandomFact() {
            const text = document.getElementById('fact-text');
            text.parentElement.classList.add('animate__animated', 'animate__flipInX');
            setTimeout(() => {
                text.innerText = facts[Math.floor(Math.random() * facts.length)];
            }, 300);
            setTimeout(() => text.parentElement.classList.remove('animate__animated', 'animate__flipInX'), 1000);
        }

        // 실행
        document.addEventListener('DOMContentLoaded', initCharts);
    </script>
</body>
</html>
